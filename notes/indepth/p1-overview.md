# LuaJIT 项目的整体结构

LuaJIT 可以大致分为以下部分：

前端部分

- LuaJIT Parser
  - 相关文件：`lj_parse.c` 等
  - 介绍：LuaJIT 的 Parser 是一个递归下降 Parser，并且采用 1 Pass 的方式分析。这意味着词法分析、语法分析、语义分析都在一次遍历中完成。这样牺牲了一些代码的可读性，但将解析性能达到了极致。这个过程的起点是 `GCproto *lj_parse(LexState *ls)`
  - 输入：Lua 代码
  - 过程：
    - 词法分析
    - 语法分析
    - 语义分析
    - 字节码生成
  - 输出：
    - 一些全局函数
    - 一些全局变量、常量（实际上全局的代码也会被当做一个函数的环境中的变量）

运行时部分

- Lua C 交互接口
  - 相关文件：`lj_api.c` 等
  - 介绍：里面是很多 `lua_` 开头的函数。用来实现 Lua 与 C 之间的交互。
- Dispatch
  - 相关文件：`lj_dispatch.c` 等
  - 介绍：LuaJIT 的指令分发函数，根据传入的字节码指令 pc，调用相应的执行函数来执行该指令。还能够触发相应的钩子函数
- BC 解释器
  - 相关文件：`lj_vm.c` `vm_*.dasc` 等
  - 介绍：LuaJIT 的虚拟机，用来执行字节码。这个虚拟机是一个基于寄存器的虚拟机，每个寄存器都可以存放一个值。这个虚拟机的指令集是基于栈的，但是在执行的时候会将栈转换为寄存器。
- JIT Trace 编译器
  - 相关文件：`lj_trace.c` 等